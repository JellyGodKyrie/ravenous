function isMobile() {
	var isMobile = false;
	if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;
	return isMobile;
}

function keypressMobile(isMobile) {
	if (isMobile) {
		$('input').keypress(function(e) {
	        var code = (e.keyCode ? e.keyCode : e.which);
	        if ( (code == 13) || (code == 10)) {
	            $(this).blur();
	            $(this).next().focus();
	            return false;
            }
	    });
	}
}

$.fn.clickToggle = function(func1, func2) {
    var funcs = [func1, func2];
    this.data('toggleclicked', 0);
    this.click(function() {
        var data = $(this).data();
        var tc = data.toggleclicked;
        $.proxy(funcs[tc], this)();
        data.toggleclicked = (tc + 1) % 2;
    });
    return this;
};

function formatState (location) {
    if (!location.id) {
        return location.text;
    }

    if (location.parent) {
        var option = $('<span>' + location.text + '</span> | <span class="node-parent">' + location.parent + '</span>');
    } else {
        var option = $('<span>' + location.text + '</span>');
    }

    return option;
}

function searchForm(json_locations_tree, object_location, object_location_city, object_location_district, object_brand, param_object_brand, json_locations_full_tree, nested_cat, nested_cat_array) {

	var url_base = 'https://www.expat-dakar.com/';

	var arrImmo = ['maisons-a-vendre', 'appartements-a-vendre', 'terrains-a-vendre', 'maisons-a-louer', 'appartements-a-louer', 'chambres-a-louer', 'proprietes-commerciales'];
	var arrAuto = ['voitures', 'motos-scooters'];
	var arrEvent = ['evenements'];

	var arrExtImmo = ['appartements-a-louer'];
	var arrExtAuto = ['voitures'];

	var arrExtPrice = ['offres-demploi', 'demandes-demploi', 'services', 'cours-particulier-formations', 'autres-emplois', 'developeurs-web-et-informatique', 'menage-personnel', 'restauration', 'chauffeur-conducteur', 'medical-sante', 'admnistratif-secretariat', 'banque-finance-comptabilite-assurance', 'marketing-communication-commercial'];

	var selected_brand;

	var isCategoryOnlySelected = true;

	isMobile = isMobile();

	var d_nested_cat = document.getElementById("nested_cat");

	if (isMobile) {
		keypressMobile(isMobile);

		$( "#advanced-search-button" ).on( "click", function() {
			$('#mod-event-deb').datepicker({
				todayBtn: true,
				language: "fr",
				todayHighlight: true,
				Readonly : true,
				autoclose: true,
				orientation: "auto auto"
			}).attr("readonly", "readonly");
			$('#mod-event-end').datepicker({
				todayBtn: true,
				language: "fr",
				todayHighlight: true,
				autoclose: true,
				orientation: "auto auto",
				Readonly : true
			}).attr("readonly", "readonly");

			$('#searchModal').modal({
				keyboard: true
			});
		});

		$('#searchModal').on('shown.bs.modal', function (event) {
			$("#modal_txt").val($("#txt").val());
			$( "#modal_ctg" ).val($("#search_category").val());

			$("#modal_ctg").change(function () {
				var nb = $(this).find("option:selected").val();
				var modal_selected_brand = $(this).find("option:selected").attr('data-brand');

				if(jQuery.inArray(nb, arrEvent) !== -1){
					setTimeout(function(){
						$('#modal_event_features').fadeIn(250);
					}, 500);
				} else {
					$("#modal_event_features").fadeOut(250);
				}

				if (jQuery.inArray(nb, arrImmo) !== -1) {
					$("#modal_car_features").fadeOut(250);
					setTimeout(function(){
				        $('#modal_immo_features').fadeIn(250);
				    }, 500);
				} else if (jQuery.inArray(nb, arrAuto) !== -1) {
					$("#modal_immo_features").fadeOut(250);
					setTimeout(function(){
				        $('#modal_car_features').fadeIn(250);
				    }, 500);
				} else {
					if ($("#modal_immo_features").is(":visible")) {
						$("#modal_immo_features").fadeOut(250);
					}

					if ($("#modal_car_features").is(":visible")) {
						$("#modal_car_features").fadeOut(250);
					}
				}

			 	if (jQuery.inArray(nb, arrExtImmo) !== -1) {
			 		if ($('#modal_immo_extra_features').hasClass('hidden')) {
			 			$('#modal_immo_extra_features').toggleClass('hidden show-inline');
			 		}
			 	} else {
			 		if ($('#modal_immo_extra_features').hasClass('show-inline')) {
			 			$('#modal_immo_extra_features').toggleClass('show-inline hidden');

			 			if ($("#modal_immo_extra_features > label > input[name=etat_appart]").is(":checked")) {
			 				$("#modal_immo_extra_features > label > input[name=etat_appart]").attr('checked', false);
			 			}
			 		}
			 	}

			 	if (jQuery.inArray(nb, arrExtAuto) !== -1) {
			 		if ($('#modal_car_extra_features').hasClass('hidden')) {
			 			$('#modal_car_extra_features').toggleClass('hidden show-inline');
			 		}
			 	} else {
			 		if ($('#modal_car_extra_features').hasClass('show-inline')) {
			 			$('#modal_car_extra_features').toggleClass('show-inline hidden');

			 			if ($("#modal_car_extra_features > label > input[name=etat_voiture]").is(":checked")) {
			 				$("#modal_car_extra_features > label > input[name=etat_voiture]").attr('checked', false);
			 			}
			 		}
			 	}

			 	if ($(this).val().length !== 0 && $(this).val() != 'all-objects') {
					if ($('#pricelist').hasClass('hidden')) {
						$("#pricelist").toggleClass('hidden show-inline');
					}

					if ($('#searchboxCategories').hasClass('hidden')) {
						$("#searchboxCategories").toggleClass('hidden show');
					}
				}

				if ($(this).val().length !== 0 && $(this).val() == 'dernieres-boutiques') {
					if ($('#pricelist').hasClass('show-inline')) {
						$("#pricelist").toggleClass('show-inline hidden');
					}

					if ($('#searchboxCategories').hasClass('show')) {
						$("#searchboxCategories").toggleClass('show hidden');
					}
				}

				var d_modal_nested_cat = document.getElementById("modal_nested_cat");
				if (typeof(d_modal_nested_cat) != 'undefined' && d_modal_nested_cat != null) {
					if (nested_cat.hasOwnProperty(nb)) {
						html = "";
						html += "<option value=\"\">Sous catégories</option>";
						for (var i = nested_cat[nb].length - 1; i >= 0; i--) {
							html += "<option value=" + nested_cat[nb][i]['slug']  + ">" + nested_cat[nb][i]['libelle'] + "</option>";
						}						
						d_modal_nested_cat.innerHTML = html;
						d_modal_nested_cat.parentElement.className = "form-group nested-cat-shown";
					} else {
						d_modal_nested_cat.innerHTML = "";
						d_modal_nested_cat.parentElement.className = "form-group nested-cat-hidden";
					}
				}

				var d_modal_object_brand = document.getElementById("modal_object_brand");
				if (typeof(d_modal_object_brand) != 'undefined' && d_modal_object_brand != null) {
					if ( typeof modal_selected_brand !== typeof undefined ) {
		                if (object_brand.hasOwnProperty(modal_selected_brand)) {
		                    html = "";
		                    html += "<option value=\"\">Toutes les marques</option>";
		                    for (var i = object_brand[modal_selected_brand].length - 1; i >= 0; i--) {
		                        
		                    	if (typeof param_object_brand !== typeof undefined && param_object_brand !== false) {

		                    		if (param_object_brand == object_brand[modal_selected_brand][i]['brand_slug']) {
		                    			html += "<option value=" + object_brand[modal_selected_brand][i]['brand_slug']  + " selected>" + object_brand[modal_selected_brand][i]['brand'] + "</option>";
		                    		} else {
		                    			html += "<option value=" + object_brand[modal_selected_brand][i]['brand_slug']  + ">" + object_brand[modal_selected_brand][i]['brand'] + "</option>";
		                    		}
		                    	} else {
		                    		html += "<option value=" + object_brand[modal_selected_brand][i]['brand_slug']  + ">" + object_brand[modal_selected_brand][i]['brand'] + "</option>";
		                    	}
		                    }
		                    d_modal_object_brand.innerHTML = html;
		                    d_modal_object_brand.parentElement.className = "form-group nested-cat-shown";
		                } else {
		                    d_modal_object_brand.innerHTML = "";
		                    d_modal_object_brand.parentElement.className = "form-group nested-cat-hidden";
		                }
		            } else {
		                d_modal_object_brand.innerHTML = "";
		                d_modal_object_brand.parentElement.className = "form-group nested-cat-hidden";
		            }
				}
			}).trigger( "change" );

			$("#modal-object_location_region").on('change', function() {
	            var region = jQuery(this).val();
	            if (region) {
	                if (json_locations_full_tree.hasOwnProperty(region)) {
	                	$("#modal-object_location").val(region);

	                    if (typeof json_locations_full_tree[region]['cities'] !== typeof undefined && json_locations_full_tree[region]['cities'] !== false) {
	                        html_1 = "";
	                        html_1 += "<option value=\"\">Zone</option>";

	                        $.each(json_locations_full_tree[region]['cities'], function(city_slug, city){
	                            html_1 += "<option value=" + city_slug  + ">" + city['name'] + "</option>";
	                        });

	                        var d = document.getElementById("modal-object_location_city");
	                        d.innerHTML = html_1;
	                        d.parentElement.className = "form-group nested-cat-shown";

	                        jQuery("#modal-object_location_city").on('change', function() {
	                            var city = jQuery(this).val();
	                            if (city) {
	                                if (json_locations_full_tree[region]['cities'].hasOwnProperty(city)) {
	                                	$("#modal-object_location").val(city);

	                                    if (typeof json_locations_full_tree[region]['cities'][city]['districts'] !== typeof undefined && json_locations_full_tree[region]['cities'][city]['districts'] !== false) {
	                                        html_2 = "";
	                                        html_2 += "<option value=\"\">Localité</option>";

	                                        $.each(json_locations_full_tree[region]['cities'][city]['districts'], function(district_slug, district){
	                                            html_2 += "<option value=" + district_slug  + ">" + district['name'] + "</option>";
	                                        });

	                                        var d = document.getElementById("modal-object_location_district");
	                                        d.innerHTML = html_2;
	                                        d.parentElement.className = "form-group nested-cat-shown";

	                                        jQuery('#modal-object_location_district').on('change', function() {
	                                        	var disctrict = jQuery(this).val();
	                                        	$("#modal-object_location").val(disctrict);
	                                        });
	                                    }
	                                }
	                            } else {
	                                //on cache le niveau suivant
	                                var d = document.getElementById("modal-object_location_district");
	                                d.innerHTML = "";
	                                d.parentElement.className = "form-group nested-cat-hidden";
	                            }
	                        }).trigger( "change" );
	                    } else {
	                        var d = document.getElementById("modal-object_location_district");
	                        d.innerHTML = "";
	                        d.parentElement.className = "form-group nested-cat-hidden";
	                    }
	                } else {
	                    var d = document.getElementById("modal-object_location_city");
	                    d.innerHTML = "";
	                    d.parentElement.className = "form-group nested-cat-hidden";
	                }
	            } else {
	                var d = document.getElementById("modal-object_location_city");
	                d.innerHTML = "";
	                d.parentElement.className = "form-group nested-cat-hidden";

	                var d = document.getElementById("modal-object_location_district");
	                d.innerHTML = "";
	                d.parentElement.className = "form-group nested-cat-hidden";
	            }
	        }).trigger( "change" );

	        if (typeof json_locations_full_tree !== typeof undefined && json_locations_full_tree !== false) {
	            html = "";
	            html += "<option value=\"\">Région</option>";

	            $.each(json_locations_full_tree, function(region_slug, region){
	                html += "<option value=" + region_slug  + ">" + region['name'] + "</option>";
	            });

	            var d = document.getElementById("modal-object_location_region");
	            d.innerHTML = html;
	        } else {
	            var d_city = document.getElementById("modal-object_location_city");
	            d_city.innerHTML = "";
	            var d_district = document.getElementById("object_location_district");
	            d_district.innerHTML = "";
	        }
		});

		$('#formModalRecherche').submit(function(e) {

			$(this).find(':input').each(function() {
	        	if( !$(this).val() || ($(this).val() == '0') ) {
	            	$(this).attr("disabled", "disabled");
	        	}
	        });

	        $(this).find(':input').each(function() {

	        	var attr_name = $(this).attr('name');

	        	if (typeof attr_name !== typeof undefined && attr_name !== false) {

	        		if ($.inArray(attr_name, ['modal_ctg', 'modal_nested_cat']) == -1) {

		            	if ($(this).is(':checkbox')) {
							if ($(this).is(":checked")) {
								isCategoryOnlySelected = false;
								return false;
							}
						} else if (($(this).val() != null) && ($(this).val() != 0)) {
							if ($(this).attr('name') == 'iml') {
								if (!$(this).val()) {
									isCategoryOnlySelected = false;
									return false;
								}
							} else {
								isCategoryOnlySelected = false;
								return false;
							}						
						}
	        		}
	        	}
	        });

			if (isCategoryOnlySelected) {

	        	if ($('#modal_ctg').val() != "") {
	        		var category = $('#modal_ctg').val();

	        		if($('#modal_nested_cat').val()) {
	        			category = $('#modal_nested_cat').val();
	        		}

	        		if (category == 'all-objects') {
	        			window.location.href = url_base + 'dernieres-annonces.html';
	        		} else {
	        			window.location.href = url_base + category + '.html';
	        		}
	        	}
	        }
		});
	} else {
		$('#searchboxToggleCategory').clickToggle(function() {
		    $('.custom-select-categories').toggleClass("show hidden");
		},
		function() {
		    $('.custom-select-categories').toggleClass("show hidden");
		});

		$('.custom-select-categories li:not(.title) > a').on('click', function(e) {
			e.preventDefault();

			var attr = $(this).attr('data-brand');
			selected_brand = attr;

			d_nested_cat.innerHTML = "";
			d_nested_cat.parentElement.className = "form-group nested-cat-hidden";

			$('#search_category').val($(this).data("category")).trigger('change');
			$('#searchboxToggleCategory').text($(this).text());

			if (($('input[name="ctg"]').length) && ($('input[name="ctg"]').val() != 0)) {
				$('.custom-select-categories').toggleClass("show hidden");
			}

			if ($(this).hasClass('from-open-browse')) {
				$("form#search_box :input").not(':button').each(function() {
					var attr_name = $(this).attr('name');
					if (typeof attr_name !== typeof undefined && attr_name !== false) {
						if ($.inArray(attr_name, ['ctg', 'nested_cat']) == -1) {
							$(this).attr('disabled','true');
						}
					}
				});
				$('#search_box').submit();
				return;
			} else {
				if($('#txt').val() == '') {
					$("form#search_box :input").not(':button').each(function() {
						var attr_name = $(this).attr('name');
						if (typeof attr_name !== typeof undefined && attr_name !== false) {
							if ($.inArray(attr_name, ['ctg', 'nested_cat']) == -1) {
								$(this).attr('disabled','true');
							}
						}
					});
					$('#search_box').submit();
				}
			}

			if (typeof attr !== typeof undefined && attr !== false) {
			    $('#search_category').val($(this).data("category")).attr( "data-brand", $(this).data("brand") ).trigger('change');
			} else {
				if ($('#search_category').attr('data-brand')) {
					$('#search_category').val($(this).data("category")).removeAttr( "data-brand" ).trigger('change');
				} else {
					$('#search_category').val($(this).data("category")).trigger('change');
				}
			}
		});

		$('#object_brand').select2({
	        placeholder: 'Toutes les marques',
	        width: '100%',
	        allowClear: true,
	    });

	    $('#object_location').on("select2:select", function(e) { 

			if (e.params.data.hasOwnProperty('city')) {
				$('input[name="city"]').val(e.params.data.city_slug);
			} else {
				$('input[name="city"]').val('');
			}

			if (e.params.data.hasOwnProperty('region')) {
				$('input[name="region"]').val(e.params.data.region_slug);
			} else {
				$('input[name="region"]').val('');
			}

			if (e.params.data.hasOwnProperty('district')) {
				$('input[name="district"]').val(e.params.data.district_slug);
			} else {
				$('input[name="district"]').val('');
			}

		}).trigger('change');

	    if (typeof object_location !== typeof undefined && object_location !== false) {

			if (object_location_district) {
				//Set disctrict
				for (var item in json_locations_tree[2].children) {
					if (json_locations_tree[2].children[item]['district_slug']  == object_location_district) {
				    	json_locations_tree[2].children[item].selected = true;
				    }
				}
			} else {

				if (object_location_city) {
					//Set city
					for (var item in json_locations_tree[1].children) {
						if (json_locations_tree[1].children[item]['city_slug']  == object_location_city) {
					    	json_locations_tree[1].children[item].selected = true;
					    }
					}
				} else {
					//Set region
					for (var item in json_locations_tree[0].children) {
						if (json_locations_tree[0].children[item]['region_slug']  == object_location) {
					    	json_locations_tree[0].children[item].selected = true;
					    }
					}
				}
			}
		}

	    $("#object_location").select2({
			placeholder: "Saisissez une localité Région, Zone, Localité",
	        data: json_locations_tree,
	        allowClear: true,
	        templateResult: formatState,
	        width: '100%',
	    });

	    $("#search_category").on('change', function() {

	    	num = $(this).val();
	    	hasDataBrand = $(this).attr('data-brand');

	    	if(jQuery.inArray(num, arrEvent) !== -1){
				if ($("#event_features").hasClass('hidden')) {
					$("#event_features").toggleClass('hidden show-inline');
				}
			} else {
				if ($("#event_features").hasClass('show-inline')) {
					$("#event_features").toggleClass('show-inline hidden');
				}
			}

			if (jQuery.inArray(num, arrImmo) !== -1) {
				if ($("#immo_features").hasClass('hidden')) {
					$("#immo_features").toggleClass('hidden show-inline');
				}
			 	if ($("#car_features").hasClass('show-inline')) {
			 		$("#car_features").toggleClass('show-inline hidden');
			 	}

			 	if ($("#regdatelist").hasClass('show-inline')) {
			 		$("#regdatelist").toggleClass('show-inline hidden');
			 	}
			} else if (jQuery.inArray(num, arrAuto) !== -1) {
				if ($("#car_features").hasClass('hidden')) {
					$("#car_features").toggleClass('hidden show-inline');
				}

				if ($("#regdatelist").hasClass('hidden')) {
					$("#regdatelist").toggleClass('hidden show-inline');
				}

			 	if ($("#immo_features").hasClass('show-inline')) {
			 		$("#immo_features").toggleClass('show-inline hidden');
			 	}
			} else {
				if ($("#immo_features").is(":visible")) {
					$("#immo_features").toggleClass('show-inline hidden');
				}

				if ($("#car_features").is(":visible")) {
					$("#car_features").toggleClass('show-inline hidden');
				}

				if ($("#regdatelist").is(":visible")) {
					$("#regdatelist").toggleClass('show-inline hidden');
				}
			}

			// Extra Features
		 	if (jQuery.inArray(num, arrExtImmo) !== -1) {
		 		if ($('#immo_extra_features').hasClass('hidden')) {
		 			$('#immo_extra_features').toggleClass('hidden show-inline');
		 		}
		 	} else {
		 		if ($('#immo_extra_features').hasClass('show-inline')) {
		 			$('#immo_extra_features').toggleClass('show-inline hidden');

		 			if ($("#immo_extra_features > label > input[name=etat_appart]").is(":checked")) {
		 				$("#immo_extra_features > label > input[name=etat_appart]").attr('checked', false);
		 			}
		 		}
		 	}

		 	if (jQuery.inArray(num, arrExtAuto) !== -1) {
		 		if ($('#car_extra_features').hasClass('hidden')) {
		 			$('#car_extra_features').toggleClass('hidden show-inline');
		 		}
		 	} else {
		 		if ($('#car_extra_features').hasClass('show-inline')) {
		 			$('#car_extra_features').toggleClass('show-inline hidden');

		 			if ($("#car_extra_features > label > input[name=etat_voiture]").is(":checked")) {
		 				$("#car_extra_features > label > input[name=etat_voiture]").attr('checked', false);
		 			}
		 		}
		 	}

			if ($(this).val().length !== 0 && $(this).val() != 'all-objects') {
				if ($('#pricelist').hasClass('hidden')) {
					$("#pricelist").toggleClass('hidden show-inline');
				}

				if ($('#searchboxCategories').hasClass('hidden')) {
					$("#searchboxCategories").toggleClass('hidden show');
				}
			}

			if ($(this).val().length !== 0 && $(this).val() == 'dernieres-boutiques') {
				if ($('#pricelist').hasClass('show-inline')) {
					$("#pricelist").toggleClass('show-inline hidden');
				}

				if ($('#searchboxCategories').hasClass('show')) {
					$("#searchboxCategories").toggleClass('show hidden');
				}
			}

			if (jQuery.inArray(num, arrExtPrice) == -1) {
		 		if ($('#pricelist').hasClass('hidden')) {
		 			$('#pricelist').toggleClass('hidden show-inline');
		 		}
		 	} else {
		 		if ($('#pricelist').hasClass('show-inline')) {
		 			$('#pricelist').toggleClass('show-inline hidden');
		 		}
		 	}

		 	if (nested_cat_array.PARENT !== undefined && typeof(nested_cat_array.PARENT) != 'undefined' && nested_cat_array.PARENT != null) {
		 		if (nested_cat.hasOwnProperty(nested_cat_array.PARENT.slug)) {
					html = "";
					html += "<option value=\"\">Sous catégories</option>";
					for (var i = nested_cat[nested_cat_array.PARENT.slug].length - 1; i >= 0; i--) {

						if (nested_cat[nested_cat_array.PARENT.slug][i]['slug'] == nested_cat_array.SLUG) {
							html += "<option value=" + nested_cat[nested_cat_array.PARENT.slug][i]['slug']  + " selected>" + nested_cat[nested_cat_array.PARENT.slug][i]['libelle'] + "</option>";
						} else {
							html += "<option value=" + nested_cat[nested_cat_array.PARENT.slug][i]['slug']  + ">" + nested_cat[nested_cat_array.PARENT.slug][i]['libelle'] + "</option>";
						}						
					}
					d_nested_cat.innerHTML = html;
					d_nested_cat.parentElement.className = "form-group nested-cat-shown";
					nested_cat_array.PARENT.slug = '';
				}
		 	} else {
			 	if (typeof(d_nested_cat) != 'undefined' && d_nested_cat != null) {
			 		if (nested_cat.hasOwnProperty(num)) {
						html = "";
						html += "<option value=\"\">Sous catégories</option>";
						for (var i = nested_cat[num].length - 1; i >= 0; i--) {
							html += "<option value=" + nested_cat[num][i]['slug']  + ">" + nested_cat[num][i]['libelle'] + "</option>";
						}
						d_nested_cat.innerHTML = html;
						d_nested_cat.parentElement.className = "form-group nested-cat-shown";
					} else {
						d_nested_cat.innerHTML = "";
						d_nested_cat.parentElement.className = "form-group nested-cat-hidden";
					}
			 	}
			 }

		 	var d_object_brand = document.getElementById("object_brand");
		 	if (typeof(d_object_brand) != 'undefined' && d_object_brand != null) {
		 		if (typeof hasDataBrand !== typeof undefined && hasDataBrand !== false) {
					selected_brand = $(this).attr('data-brand');
				}

				if ( typeof selected_brand !== typeof undefined ) {
		            if (object_brand.hasOwnProperty(selected_brand)) {
		                html = "";
		                html += "<option value=\"\">Toutes les marques</option>";

		                for (var i = object_brand[selected_brand].length - 1; i >= 0; i--) {

		                	if (typeof hasDataBrand !== typeof undefined && hasDataBrand !== false) {
		                		if (param_object_brand == object_brand[selected_brand][i]['brand_slug']) {
		                			html += "<option value=" + object_brand[selected_brand][i]['brand_slug']  + " selected>" + object_brand[selected_brand][i]['brand'] + "</option>";
		                		} else {
		                			html += "<option value=" + object_brand[selected_brand][i]['brand_slug']  + ">" + object_brand[selected_brand][i]['brand'] + "</option>";
		                		}
		                	} else {
		                		html += "<option value=" + object_brand[selected_brand][i]['brand_slug']  + ">" + object_brand[selected_brand][i]['brand'] + "</option>";
		                	}
		                }
	                	d_object_brand.innerHTML = html;
	                	d_object_brand.parentElement.className = "form-group nested-cat-shown";
		            } else {
	                	d_object_brand.innerHTML = "";
	                	d_object_brand.parentElement.className = "form-group nested-cat-hidden";
		            }
		        } else {
	            	d_object_brand.innerHTML = "";
	            	d_object_brand.parentElement.className = "form-group nested-cat-hidden";
		        }
		 	}
	    }).trigger( "change" );

		$("#search_box").submit(function( event ) {
			$(this).find(':input').each(function() {
	        	if( !$(this).val() || ($(this).val() == '0') ) {
	            	$(this).attr("disabled", "disabled");
	        	}
	        });

	        $(this).find(':input').each(function() {

	        	var attr_name = $(this).attr('name');

	        	if (typeof attr_name !== typeof undefined && attr_name !== false) {

	        		if ($.inArray(attr_name, ['ctg', 'nested_cat']) == -1) {

		            	if ($(this).is(':checkbox')) {
							if ($(this).is(":checked")) {
								isCategoryOnlySelected = false;
								return false;
							}
						} else if (($(this).val() != null) && ($(this).val() != 0)) {
							if ($(this).attr('name') == 'iml') {
								if (!$(this).val()) {
									isCategoryOnlySelected = false;
									return false;
								}
							} else {
								isCategoryOnlySelected = false;
								return false;
							}						
						}
	        		}
	        	}
	        });

	        if (isCategoryOnlySelected) {
	        	event.preventDefault();
	        	if (($('input[name="ctg"]').length) && ($('input[name="ctg"]').val() != 0)) {
	        		var category = $('input[name="ctg"]').val();

	        		if($('#nested_cat').val()) {
	        			category = $('#nested_cat').val();
	        		}

	        		if (category == 'all-objects') {
	        			window.location.href = url_base + 'dernieres-annonces';
	        		} else {
	        			window.location.href = url_base + category;
	        		}
	        	} else {
	        		window.location.href = url_base + 'dernieres-annonces';
	        	}
	        }

	        return true;
		});

		$('#search_box_resp').submit(function(e) {
			var isCategoryOnlySelected = true;

			$(this).find(':input').each(function() {
            	if( !$(this).val() || ($(this).val() == '0') ) {
	            	$(this).attr("disabled", "disabled");
            	}
            });

			var input = $(this);

			if (input.attr('name') !== 'ctg') {
				if (input.is(':checkbox')) {
					if (input.is(":checked")) {
						isCategoryOnlySelected = false;
						return false;
					}
				} else if (input.val().length !== 0) {
					if (input.attr('name') == 'iml') {
						if (!input.val()) {
							isCategoryOnlySelected = false;
							return false;
						}
					} else {
						isCategoryOnlySelected = false;
						return false;
					}						
				}
			}

			if (isCategoryOnlySelected) {
				if (($('input[name="ctg"]').length) && ($('input[name="ctg"]').val() != 0)) {
					var category = $('input[name="ctg"]').val();
					if (category != 'all-shops') {
						event.preventDefault();
					}

					if (category == 'all-objects') {
						window.location.href = "<?= $_SESSION['expat']['url']; ?>" + 'dernieres-annonces';
					} else {
						if (category != 'all-shops') {
							window.location.href = "<?= $_SESSION['expat']['url']; ?>" + category;
						}
					}
				}
			}
		});
	}
}